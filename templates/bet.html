<!DOCTYPE html>
<html>

<head>
    <!--bootstrap for style -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <!--leaflet for map-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <title>Home</title>
    {% load static %}
    {% load custom_filters %}
    <link rel="shortcut icon" type="image/png" href="{%static 'favicon.ico' %}" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="robots" content="index,follow">
    <meta name="generator" content="GrapesJS Studio">
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body id="iau9" style="height: 100svh;">
    {% include "menu.html" %}
    <div class="container-fluid h-100">
         {% if Error %}
        <div class="alert alert-warning" role="alert">
            {{Error}}
        </div>
        {% endif %}
        <div class="row h-100">
            <div class="col-md-8 overflow-auto order-md-1 order-2 mt-3" style="max-height: 100%;">
                <div class="card bg-light text-black" style="height: 20%;">
                    {% if space.image %}<img src="{{space.image.url}}" class="card-img" alt="..."
                    style="
                        object-fit: cover;
                        align: center;
                        object-position: center;
                        height: 100%;
                        width: 100%;"

                    >{% endif %}
                    <div class="card-img-overlay", style="
                    backdrop-filter: blur(10px);
                    background-color: rgba(255, 255, 255, 0.3);
                    text-shadow: 0 0 .5em white, 0 0 .5em white, 0 0 .5em white;
                    ">
                        <h5 class="card-title">{{space.name}}</h5>
                        <p class="card-text">{{space.room}}</p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12 d-flex justify-content-between">
                        <div class="flex-grow-1 me-3">
                            <h5>Description</h5>
                            <p>{{space.description}}</p>
                        </div>
                        <div class="d-flex flex-column">
                            <form method="post" action="{% url 'card' space.pk %}">
                                {% csrf_token %}
                                <div class="row mb-1 me-1"><button type="submit" name="op" value="upvote" class="btn btn-success" style="background-color: #627313">{{space.upvotes}}üëç</button></div>
                                    <div class="row me-1"><button type="submit" name="op" value="downvote" class="btn btn-danger" style="background-color: #B7352D">{{space.downvotes}}üëé</button></div>
                            </form>
                        </div> 
                    </div>
                </div>
                <div class="mt-3">
                    <h5>Tags</h5>
                    <div class="container d-flex flex-wrap gap-1">
                        {% for tag in space.tags.all %}
                        {% include "tag.html" %}
                        {% endfor %}
                    </div>
                </div>
                <div class="mt-3">
                    <h5>Add a Comment</h5>
                    <form method="post" action="{% url 'card' space.pk %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <textarea class="form-control" name="comment" rows="3" placeholder="Write your comment here..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="background-color: #215CAF">Submit</button>
                    </form>
                </div>
                <div class="mt-3">
                    <h5>Comments</h5>
                    <div class="card">
                        <div class="card-body">
                            {% for comment in space.comments.all %}
                            <div class="mb-2 commentsInBigView" id="commentsInBigView">
                                <p>{{ comment.comment }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            <!--descriptio, to the right we want up/ down vote--> 
            <!-- we want the spaces tags, ideally with the same theeming--> 
            </div>
            <div class="col-md-4 d-flex flex-column order-md-2 order-1">
                <div id="map" class="flex-grow-1 mt-3" style="min-height: 200px;">
                    <script>
                        var tags = [{ name: "{{ space.name }}", position: [{{ space.latitude }}, {{ space.longitude }}] }]
                        var map = L.map('map').setView([{{space.latitude}}, {{space.longitude}}], 17);
                        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                        }).addTo(map);

                        var markers = tags.map((x) => L.marker(x.position).addTo(map).bindPopup(x.name))
                    </script>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
